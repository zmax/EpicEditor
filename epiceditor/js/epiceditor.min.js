(function(window,undefined){function _applyAttrs(context,attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){context[attr]=attrs[attr]}}}function _applyStyles(context,attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){context.style[attr]=attrs[attr]}}}function _getStyle(el,styleProp){var x=el,y=null;if(window.getComputedStyle){y=document.defaultView.getComputedStyle(x,null).getPropertyValue(styleProp)}else if(x.currentStyle){y=x.currentStyle[styleProp]}return y}function _saveStyleState(el,type,styles){var returnState={},style;if(type==="save"){for(style in styles){if(styles.hasOwnProperty(style)){returnState[style]=_getStyle(el,style)}}_applyStyles(el,styles)}else if(type==="apply"){_applyStyles(el,styles)}return returnState}function _outerWidth(el){var b=parseInt(_getStyle(el,"border-left-width"),10)+parseInt(_getStyle(el,"border-right-width"),10),p=parseInt(_getStyle(el,"padding-left"),10)+parseInt(_getStyle(el,"padding-right"),10),w=el.offsetWidth,t;if(isNaN(b)){b=0}t=b+p+w;return t}function _outerHeight(el){var b=parseInt(_getStyle(el,"border-top-width"),10)+parseInt(_getStyle(el,"border-bottom-width"),10),p=parseInt(_getStyle(el,"padding-top"),10)+parseInt(_getStyle(el,"padding-bottom"),10),w=el.offsetHeight,t;if(isNaN(b)){b=0}t=b+p+w;return t}function _insertCSSLink(path,context,id){id=id||"";var headID=context.getElementsByTagName("head")[0],cssNode=context.createElement("link");_applyAttrs(cssNode,{type:"text/css",id:id,rel:"stylesheet",href:path,name:path,media:"screen"});headID.appendChild(cssNode)}function findOffset(root,ss){if(!root){return null}var offset=0,element=root,container,len;do{container=element;element=element.firstChild;if(element){do{len=element.textContent.length;if(offset<=ss&&offset+len>ss){break}offset+=len}while(element=element.nextSibling)}if(!element){break}}while(element&&element.hasChildNodes()&&element.nodeType!=3);if(element){return{element:element,offset:ss-offset}}else if(container){element=container;while(element&&element.lastChild){element=element.lastChild}if(element.nodeType===3){return{element:element,offset:element.textContent.length}}else{return{element:element,offset:0}}}return{element:root,offset:0,error:true}}function _replaceClass(e,o,n){e.className=e.className.replace(o,n)}function _getIframeInnards(el){return el.contentDocument||el.contentWindow.document}function _getText(el){var node,nodeType=el.nodeType,i=0,text;if(nodeType===1||nodeType===9||nodeType===11){if(typeof el.textContent==="string"){return el.textContent}else{for(el=el.firstChild;el;el=el.nextSibling){text+=_getText(el)}}}return text}function _setText(el,content){el.textContent=content;return true}function _isIE(){var rv=-1,ua=navigator.userAgent,re;if(navigator.appName=="Microsoft Internet Explorer"){re=/MSIE ([0-9]{1,}[\.0-9]{0,})/;if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1,10)}}return rv}function _isSafari(){var n=window.navigator;return n.userAgent.indexOf("Safari")>-1&&n.userAgent.indexOf("Chrome")==-1}function _isFunction(functionToCheck){var getType={};return functionToCheck&&getType.toString.call(functionToCheck)==="[object Function]"}function _mergeObjs(){var target=arguments[0]||{},i=1,length=arguments.length,deep=false,options,name,src,copy;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!_isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&typeof copy==="object"&&!copy.nodeType){target[name]=_mergeObjs(deep,src||(copy.length!=null?[]:{}),copy)}else if(copy!==undefined){target[name]=copy}}}}}return target}function EpicEditor(options){var self=this,opts=options||{},_defaultFileSchema,_defaultFile,defaults={container:"epiceditor",basePath:"epiceditor",clientSideStorage:true,localStorageName:"epiceditor",useNativeFullscreen:true,file:{name:null,defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-dark.css"},focusOnLoad:false,smartIndent:true,smartTabs:true,shortcut:{modifier:18,fullscreen:70,preview:80},parser:typeof marked=="function"?marked:null},defaultStorage;self.settings=_mergeObjs(true,defaults,opts);if(!(typeof self.settings.parser=="function"&&typeof self.settings.parser("TEST")=="string")){self.settings.parser=function(str){return str}}if(typeof self.settings.container=="string"){self.element=document.getElementById(self.settings.container)}else if(typeof self.settings.container=="object"){self.element=self.settings.container}if(!self.settings.file.name){if(typeof self.settings.container=="string"){self.settings.file.name=self.settings.container}else if(typeof self.settings.container=="object"){if(self.element.id){self.settings.file.name=self.element.id}else{if(!EpicEditor._data.unnamedEditors){EpicEditor._data.unnamedEditors=[]}EpicEditor._data.unnamedEditors.push(self);self.settings.file.name="__epiceditor-untitled-"+EpicEditor._data.unnamedEditors.length}}}self._instanceId="epiceditor-"+Math.round(Math.random()*1e5);self._storage={};self._canSave=true;self._defaultFileSchema=function(){return{content:self.settings.file.defaultContent,created:new Date,modified:new Date}};if(localStorage&&self.settings.clientSideStorage){this._storage=localStorage;if(this._storage[self.settings.localStorageName]&&self.getFiles(self.settings.file.name)===undefined){_defaultFile=self.getFiles(self.settings.file.name);_defaultFile=self._defaultFileSchema();_defaultFile.content=self.settings.file.defaultContent}}if(!this._storage[self.settings.localStorageName]){defaultStorage={};defaultStorage[self.settings.file.name]=self._defaultFileSchema();defaultStorage=JSON.stringify(defaultStorage);this._storage[self.settings.localStorageName]=defaultStorage}self._eeState={fullscreen:false,preview:false,edit:false,loaded:false,unloaded:false};if(!self.events){self.events={}}return this}EpicEditor.prototype.load=function(callback){if(this.is("loaded")){return this}var self=this,_HtmlTemplates,iframeElement,baseTag,widthDiff,heightDiff,utilBtns,utilBar,utilBarTimer,keypressTimer,mousePos={y:-1,x:-1},_elementStates,_isInEdit,nativeFs=false,elementsToResize,fsElement,isMod=false,isCtrl=false,isShift=false,eventableIframes,i;if(self.settings.useNativeFullscreen){nativeFs=document.body.webkitRequestFullScreen?true:false}if(_isSafari()){nativeFs=false}if(!self.is("edit")&&!self.is("preview")){self._eeState.edit=true}callback=callback||function(){};_HtmlTemplates={chrome:'<div id="epiceditor-wrapper" class="epiceditor-edit-mode">'+'<iframe frameborder="0" id="epiceditor-editor-frame"></iframe>'+'<iframe frameborder="0" id="epiceditor-previewer-frame"></iframe>'+'<div id="epiceditor-utilbar">'+'<img width="30" src="'+this.settings.basePath+'/images/preview.png" title="Toggle Preview Mode" class="epiceditor-toggle-btn epiceditor-toggle-preview-btn"> '+'<img width="30" src="'+this.settings.basePath+'/images/edit.png" title="Toggle Edit Mode" class="epiceditor-toggle-btn epiceditor-toggle-edit-btn"> '+'<img width="30" src="'+this.settings.basePath+'/images/fullscreen.png" title="Enter Fullscreen" class="epiceditor-fullscreen-btn">'+"</div>"+"</div>",previewer:'<div id="epiceditor-preview"></div>'};function setupIframeStyles(el){for(var x=0;x<el.length;x++){el[x].style.width=self.element.offsetWidth-widthDiff+"px";el[x].style.height=self.element.offsetHeight-heightDiff+"px"}}function resetWidth(el){widthDiff=_outerWidth(self.element)-self.element.offsetWidth;for(var x=0;x<el.length;x++){el[x].style.width=self.element.offsetWidth-widthDiff+"px"}}self.element.innerHTML='<iframe scrolling="no" frameborder="0" id= "'+self._instanceId+'"></iframe>';iframeElement=document.getElementById(self._instanceId);self.iframeElement=iframeElement;self.iframe=_getIframeInnards(iframeElement);self.iframe.open();self.iframe.write(_HtmlTemplates.chrome);self.editorIframe=self.iframe.getElementById("epiceditor-editor-frame");self.previewerIframe=self.iframe.getElementById("epiceditor-previewer-frame");self.editorIframeDocument=_getIframeInnards(self.editorIframe);self.editorIframeDocument.open();self.editorIframeDocument.write("");self.editorIframeDocument.close();self.previewerIframeDocument=_getIframeInnards(self.previewerIframe);self.previewerIframeDocument.open();self.previewerIframeDocument.write(_HtmlTemplates.previewer);baseTag=self.previewerIframeDocument.createElement("base");baseTag.target="_blank";self.previewerIframeDocument.getElementsByTagName("head")[0].appendChild(baseTag);self.previewerIframeDocument.close();widthDiff=_outerWidth(self.element)-self.element.offsetWidth;heightDiff=_outerHeight(self.element)-self.element.offsetHeight;elementsToResize=[self.iframeElement,self.editorIframe,self.previewerIframe];setupIframeStyles(elementsToResize);_insertCSSLink(self.settings.basePath+self.settings.theme.base,self.iframe,"theme");_insertCSSLink(self.settings.basePath+self.settings.theme.editor,self.editorIframeDocument,"theme");_insertCSSLink(self.settings.basePath+self.settings.theme.preview,self.previewerIframeDocument,"theme");self.iframe.getElementById("epiceditor-wrapper").style.position="relative";self.editor=self.editorIframeDocument.body;self.previewer=self.previewerIframeDocument.getElementById("epiceditor-preview");self.editor.contentEditable=true;self.iframe.body.style.height=this.element.offsetHeight+"px";this.previewerIframe.style.display="none";if(_isIE()>-1){this.previewer.style.height=parseInt(_getStyle(this.previewer,"height"),10)+2}this.open(self.settings.file.name);if(self.settings.focusOnLoad){self.iframe.addEventListener("readystatechange",function(){if(self.iframe.readyState=="complete"){self.editorIframeDocument.body.focus()}})}utilBtns=self.iframe.getElementById("epiceditor-utilbar");_elementStates={};self._goFullscreen=function(el){if(self.is("fullscreen")){self._exitFullscreen(el);return}if(nativeFs){el.webkitRequestFullScreen()}_isInEdit=self.is("edit");self._eeState.fullscreen=true;self._eeState.edit=true;self._eeState.preview=true;var windowInnerWidth=window.innerWidth,windowInnerHeight=window.innerHeight,windowOuterWidth=window.outerWidth,windowOuterHeight=window.outerHeight;if(!nativeFs){windowOuterHeight=window.innerHeight}_elementStates.editorIframe=_saveStyleState(self.editorIframe,"save",{width:windowOuterWidth/2+"px",height:windowOuterHeight+"px","float":"left",cssFloat:"left",styleFloat:"left",display:"block"});_elementStates.previewerIframe=_saveStyleState(self.previewerIframe,"save",{width:windowOuterWidth/2+"px",height:windowOuterHeight+"px","float":"right",cssFloat:"right",styleFloat:"right",display:"block"});_elementStates.element=_saveStyleState(self.element,"save",{position:"fixed",top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",margin:"0",background:_getStyle(self.editor,"background-color"),height:windowInnerHeight+"px"});_elementStates.iframeElement=_saveStyleState(self.iframeElement,"save",{width:windowOuterWidth+"px",height:windowInnerHeight+"px"});utilBtns.style.visibility="hidden";if(!nativeFs){document.body.style.overflow="hidden"}self.preview();self.editorIframeDocument.body.focus();self.emit("fullscreenenter")};self._exitFullscreen=function(el){_saveStyleState(self.element,"apply",_elementStates.element);_saveStyleState(self.iframeElement,"apply",_elementStates.iframeElement);_saveStyleState(self.editorIframe,"apply",_elementStates.editorIframe);_saveStyleState(self.previewerIframe,"apply",_elementStates.previewerIframe);self.element.style.width="";self.element.style.height="";utilBtns.style.visibility="visible";if(!nativeFs){document.body.style.overflow="auto"}else{document.webkitCancelFullScreen()}self._eeState.fullscreen=false;if(_isInEdit){self.edit()}else{self.preview()}resetWidth(elementsToResize);self.emit("fullscreenexit")};self._indent=function(inverse){if(!self.settings.smartTabs){return}var body=self.editorIframeDocument.body,content=_getText(body),ss=self._getSelectionStart(),se=self._getSelectionEnd(),before=content.slice(0,ss),after=content.slice(se),selection=content.slice(ss,se),lf=before.lastIndexOf("\n")+1;if(inverse){if(/\s/.test(before.charAt(lf))){before=before.splice(lf,1);ss-=1;se-=1}selection=selection.replace(/\r?\n\s/g,"\n")}else if(selection){before=before.splice(lf,0,"	");selection=selection.replace(/\r?\n/g,"\n	")}else{before+="	";console.log(before,selection,after);ss+=1;se+=1;_setText(body,before+selection+after);self._setSelectionRange(ss,se);return}se=ss+selection.length;_setText(before+selection+after);self._setSelectionRange(ss,se)};self._insertNewLine=function(){if(self.settings.smartIndent===false){self.insertText("\n")}else{var body=self.editorIframeDocument.body,content=_getText(body),ss=self._getSelectionStart(),before=content.slice(0,ss),lf=before.lastIndexOf("\n")+1,indent=(before.slice(lf).match(/^\s+/)||[""])[0];self.insertText("\n"+indent)}};self._getSelectionStart=function(){var iframeDocument=self.editorIframeDocument,body=self.editorIframeDocument.body,selection=self.getSelection(),range,element,container,offset;if(selection.rangeCount){range=selection.getRangeAt(0);element=range.startContainer;container=element;offset=range.startOffset;if(!(body.compareDocumentPosition(element)&16)){return 0}do{while(element=element.previousSibling){if(element.textContent){offset+=element.textContent.length}}element=container=container.parentNode}while(element&&element!=body);return offset}else{return 0}};self._getSelectionEnd=function(){var selection=self.getSelection();if(selection.rangeCount){return self._getSelectionStart()+(selection.getRangeAt(0)+"").length}return 0};self._setSelectionRange=function(ss,se){var iframeDocument=self.editorIframeDocument,body=iframeDocument.body,range=iframeDocument.createRange(),offset=findOffset(body,ss),selection;range.setStart(offset.element,offset.offset);if(se&&se!=ss){offset=findOffset(body,se)}range.setEnd(offset.element,offset.offset);selection=self.getSelection();selection.removeAllRanges();selection.addRange(range)};self.editor.addEventListener("keyup",function(){if(keypressTimer){window.clearTimeout(keypressTimer)}keypressTimer=window.setTimeout(function(){if(self.is("fullscreen")){self.preview()}},250)});fsElement=self.iframeElement;utilBtns.addEventListener("click",function(e){var targetClass=e.target.className;if(targetClass.indexOf("epiceditor-toggle-preview-btn")>-1){self.preview()}else if(targetClass.indexOf("epiceditor-toggle-edit-btn")>-1){self.edit()}else if(targetClass.indexOf("epiceditor-fullscreen-btn")>-1){self._goFullscreen(fsElement)}});if(document.body.webkitRequestFullScreen){fsElement.addEventListener("webkitfullscreenchange",function(){if(!document.webkitIsFullScreen){self._exitFullscreen(fsElement)}},false)}utilBar=self.iframe.getElementById("epiceditor-utilbar");utilBar.style.display="none";utilBar.addEventListener("mouseover",function(){if(utilBarTimer){clearTimeout(utilBarTimer)}});function utilBarHandler(e){if(Math.abs(mousePos.y-e.pageY)>=5||Math.abs(mousePos.x-e.pageX)>=5){utilBar.style.display="block";if(utilBarTimer){clearTimeout(utilBarTimer)}utilBarTimer=window.setTimeout(function(){utilBar.style.display="none"},1e3)}mousePos={y:e.pageY,x:e.pageX}}function shortcutHandler(e){if(e.keyCode==self.settings.shortcut.modifier){isMod=true}if(e.keyCode==17){isCtrl=true}if(e.keyCode==13){e.preventDefault();e.stopPropagation();self._insertNewLine();shortcutUpHandler()}if(e.keyCode==9&&!(isMod||isCtrl)){e.preventDefault();e.stopPropagation();self._indent(false);shortcutUpHandler()}if(isMod===true&&e.keyCode==self.settings.shortcut.preview&&!self.is("fullscreen")){e.preventDefault();if(self.is("edit")){self.preview()}else{self.edit()}}if(isMod===true&&e.keyCode==self.settings.shortcut.fullscreen){e.preventDefault();self._goFullscreen(fsElement)}if(isMod===true&&e.keyCode!==self.settings.shortcut.modifier){isMod=false}if(e.keyCode==27&&self.is("fullscreen")){self._exitFullscreen(fsElement)}if(isCtrl===true&&e.keyCode==83){self.save();e.preventDefault();isCtrl=false}if(e.metaKey&&e.keyCode==83){self.save();e.preventDefault()}}function shortcutUpHandler(e){var keyCode=e&&e.keyCode||0,content,ss,se;if([9,91,93,16,17,18,20,13,112,113,114,115,116,117,118,119,120,121,122,123,27].indexOf(keyCode)>-1){return}if(keyCode==self.settings.shortcut.modifier){isMod=false}if(keyCode==17){isCtrl=false}if(keyCode!==37&&keyCode!==39){content=_getText(self.editorIframeDocument.body);ss=self._getSelectionStart();se=self._getSelectionEnd();if(!/\n$/.test(content)){self.editorIframeDocument.body.innerHTML=self.editorIframeDocument.body.innerHTML+"\n"}if(ss!=null||se!==null){self._setSelectionRange(ss,se)}}}eventableIframes=[self.previewerIframeDocument,self.editorIframeDocument];for(i=0;i<eventableIframes.length;i++){eventableIframes[i].addEventListener("mousemove",function(e){utilBarHandler(e)});eventableIframes[i].addEventListener("scroll",function(e){utilBarHandler(e)});eventableIframes[i].addEventListener("keyup",function(e){shortcutUpHandler(e)});eventableIframes[i].addEventListener("keydown",function(e){return shortcutHandler(e)})}if(self.settings.file.autoSave){self.saveInterval=window.setInterval(function(){if(!self._canSave){return}self.save()},self.settings.file.autoSave)}window.addEventListener("resize",function(){if(!self.iframe.webkitRequestFullScreen&&self.is("fullscreen")){_applyStyles(self.iframeElement,{width:window.outerWidth+"px",height:window.innerHeight+"px"});_applyStyles(self.element,{height:window.innerHeight+"px"});_applyStyles(self.previewerIframe,{width:window.outerWidth/2+"px",height:window.innerHeight+"px"});_applyStyles(self.editorIframe,{width:window.outerWidth/2+"px",height:window.innerHeight+"px"})}else if(!self.is("fullscreen")){resetWidth(elementsToResize)}});self._eeState.loaded=true;self._eeState.unloaded=false;if(self.is("preview")){self.preview()}else{self.edit()}self.iframe.close();callback.call(this);this.emit("load");return this};EpicEditor.prototype.unload=function(callback){if(this.is("unloaded")){throw new Error("Editor isn't loaded")}var self=this,editor=window.parent.document.getElementById(self._instanceId);editor.parentNode.removeChild(editor);self._eeState.loaded=false;self._eeState.unloaded=true;callback=callback||function(){};if(self.saveInterval){window.clearInterval(self.saveInterval)}callback.call(this);self.emit("unload");return self};EpicEditor.prototype.preview=function(theme){var self=this,x,anchors;theme=theme||self.settings.basePath+self.settings.theme.preview;_replaceClass(self.getElement("wrapper"),"epiceditor-edit-mode","epiceditor-preview-mode");if(!self.previewerIframeDocument.getElementById("theme")){_insertCSSLink(theme,self.previewerIframeDocument,"theme")}else if(self.previewerIframeDocument.getElementById("theme").name!==theme){self.previewerIframeDocument.getElementById("theme").href=theme}self.previewer.innerHTML=self.exportFile(null,"html");anchors=self.previewer.getElementsByTagName("a");for(x in anchors){if(anchors[x].hash&&anchors[x].hostname==window.location.hostname){anchors[x].target="_self"}}if(!self.is("fullscreen")){self.editorIframe.style.display="none";self.previewerIframe.style.display="block";self._eeState.preview=true;self._eeState.edit=false;self.previewerIframe.focus()}self.emit("preview");return self};EpicEditor.prototype.enterFullscreen=function(){if(this.is("fullscreen")){return this}this._goFullscreen(this.iframeElement);return this};EpicEditor.prototype.exitFullscreen=function(){if(!this.is("fullscreen")){return this}this._exitFullscreen(this.iframeElement);return this};EpicEditor.prototype.edit=function(){var self=this;_replaceClass(self.getElement("wrapper"),"epiceditor-preview-mode","epiceditor-edit-mode");self._eeState.preview=false;self._eeState.edit=true;self.editorIframe.style.display="block";self.previewerIframe.style.display="none";self.editorIframe.focus();self.emit("edit");return this};EpicEditor.prototype.getSelection=function(){return this.editorIframeDocument.getSelection()};EpicEditor.prototype.getText=function(){var body=this.editorIframeDocument.body;return _getText(body)};EpicEditor.prototype.insertText=function(text){if(!text||text.length===0){return}var body=this.editorIframeDocument.body,content=_getText(body),ss=this._getSelectionStart(),se=this._getSelectionEnd(),before=content.slice(0,ss),after=content.slice(se),selection=content.slice(ss,se),lf=before.lastIndexOf("\n")+1,indent=(before.slice(lf).match(/^\s+/)||[""])[0];before+=text;selection="";_setText(body,before+selection+after);ss+=indent.length+text.length;se=ss;this._setSelectionRange(ss,se);return this};EpicEditor.prototype.getElement=function(name){var available={container:this.element,wrapper:this.iframe.getElementById("epiceditor-wrapper"),wrapperIframe:this.iframeElement,editor:this.editorIframeDocument,editorIframe:this.editorIframe,previewer:this.previewerIframeDocument,previewerIframe:this.previewerIframe};if(!available[name]||this.is("unloaded")){return null}else{return available[name]}};EpicEditor.prototype.is=function(what){var self=this;switch(what){case"loaded":return self._eeState.loaded;case"unloaded":return self._eeState.unloaded;case"preview":return self._eeState.preview;case"edit":return self._eeState.edit;case"fullscreen":return self._eeState.fullscreen;default:return false}};EpicEditor.prototype.open=function(name){var self=this,defaultContent=self.settings.file.defaultContent,fileObj;name=name||self.settings.file.name;self.settings.file.name=name;if(this._storage[self.settings.localStorageName]){fileObj=self.getFiles();if(fileObj[name]!==undefined){_setText(self.editor,fileObj[name].content);self.emit("read")}else{_setText(self.editor,defaultContent);self.save();self.emit("create")}self.previewer.innerHTML=self.exportFile(null,"html");self.emit("open")}return this};EpicEditor.prototype.save=function(){var self=this,storage,isUpdate=false,file=self.settings.file.name,content=_getText(this.editor);this._canSave=true;storage=JSON.parse(this._storage[self.settings.localStorageName]);if(storage[file]===undefined){storage[file]=self._defaultFileSchema()}else if(content!==storage[file].content){storage[file].modified=new Date;isUpdate=true}storage[file].content=content;this._storage[self.settings.localStorageName]=JSON.stringify(storage);if(isUpdate){self.emit("update")}this.emit("save");return this};EpicEditor.prototype.remove=function(name){var self=this,s;name=name||self.settings.file.name;if(name==self.settings.file.name){self._canSave=false}s=JSON.parse(this._storage[self.settings.localStorageName]);delete s[name];this._storage[self.settings.localStorageName]=JSON.stringify(s);this.emit("remove");return this};EpicEditor.prototype.rename=function(oldName,newName){var self=this,s=JSON.parse(this._storage[self.settings.localStorageName]);s[newName]=s[oldName];delete s[oldName];this._storage[self.settings.localStorageName]=JSON.stringify(s);self.open(newName);return this};EpicEditor.prototype.importFile=function(name,content,kind,meta){var self=this,isNew=false;name=name||self.settings.file.name;content=content||"";kind=kind||"md";meta=meta||{};if(JSON.parse(this._storage[self.settings.localStorageName])[name]===undefined){isNew=true}self.settings.file.name=name;_setText(self.editor,content);if(isNew){self.emit("create")}self.save();if(self.is("fullscreen")){self.preview()}return this};EpicEditor.prototype.exportFile=function(name,kind){var self=this,file,content;name=name||self.settings.file.name;kind=kind||"text";file=self.getFiles(name);if(file===undefined){return}content=file.content;switch(kind){case"html":content=content.replace(/\u00a0/g," ").replace(/&nbsp;/g," ");return self.settings.parser(content);case"text":content=content.replace(/&nbsp;/g," ");return content;default:return content}};EpicEditor.prototype.getFiles=function(name){var files=JSON.parse(this._storage[this.settings.localStorageName]);if(name){return files[name]}else{return files}};EpicEditor.prototype.on=function(ev,handler){var self=this;if(!this.events[ev]){this.events[ev]=[]}this.events[ev].push(handler);return self};EpicEditor.prototype.emit=function(ev,data){var self=this,x;data=data||self.getFiles(self.settings.file.name);if(!this.events[ev]){return}function invokeHandler(handler){handler.call(self,data)}for(x=0;x<self.events[ev].length;x++){invokeHandler(self.events[ev][x])}return self};EpicEditor.prototype.removeListener=function(ev,handler){var self=this;if(!handler){this.events[ev]=[];return self}if(!this.events[ev]){return self}this.events[ev].splice(this.events[ev].indexOf(handler),1);return self};EpicEditor.version="0.1.1";EpicEditor._data={};window.EpicEditor=EpicEditor})(window);(function(){var block={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:noop,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [^\0]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};block.bullet=/(?:[*+-]|\d+\.)/;block.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;block.item=replace(block.item,"gm")(/bull/g,block.bullet)();block.list=replace(block.list)(/bull/g,block.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();block.html=replace(block.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?!:\/|@)\b(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,tag())();block.paragraph=function(){var paragraph=block.paragraph.source,body=[];(function push(rule){rule=block[rule]?block[rule].source:rule;body.push(rule.replace(/(^|[^\[])\^/g,"$1"));return push})("hr")("heading")("lheading")("blockquote")("<"+tag())("def");return new RegExp(paragraph.replace("body",body.join("|")))}();block.normal={fences:block.fences,paragraph:block.paragraph};block.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/};block.gfm.paragraph=replace(block.paragraph)("(?!","(?!"+block.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")();block.lexer=function(src){var tokens=[];tokens.links={};src=src.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ");return block.token(src,tokens,true)};block.token=function(src,tokens,top){var src=src.replace(/^ +$/gm,""),next,loose,cap,item,space,i,l;while(src){if(cap=block.newline.exec(src)){src=src.substring(cap[0].length);if(cap[0].length>1){tokens.push({type:"space"})}}if(cap=block.code.exec(src)){src=src.substring(cap[0].length);cap=cap[0].replace(/^ {4}/gm,"");tokens.push({type:"code",text:!options.pedantic?cap.replace(/\n+$/,""):cap});continue}if(cap=block.fences.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"code",lang:cap[1],text:cap[2]});continue}if(cap=block.heading.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"heading",depth:cap[1].length,text:cap[2]});continue}if(cap=block.lheading.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"heading",depth:cap[2]==="="?1:2,text:cap[1]});continue}if(cap=block.hr.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"hr"});continue}if(cap=block.blockquote.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"blockquote_start"});cap=cap[0].replace(/^ *> ?/gm,"");block.token(cap,tokens,top);tokens.push({type:"blockquote_end"});continue}if(cap=block.list.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"list_start",ordered:isFinite(cap[2])});cap=cap[0].match(block.item);next=false;l=cap.length;i=0;for(;i<l;i++){item=cap[i];space=item.length;item=item.replace(/^ *([*+-]|\d+\.) +/,"");if(~item.indexOf("\n ")){space-=item.length;item=!options.pedantic?item.replace(new RegExp("^ {1,"+space+"}","gm"),""):item.replace(/^ {1,4}/gm,"")}loose=next||/\n\n(?!\s*$)/.test(item);if(i!==l-1){next=item[item.length-1]==="\n";if(!loose)loose=next}tokens.push({type:loose?"loose_item_start":"list_item_start"});block.token(item,tokens);tokens.push({type:"list_item_end"})}tokens.push({type:"list_end"});continue}if(cap=block.html.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"html",pre:cap[1]==="pre",text:cap[0]});continue}if(top&&(cap=block.def.exec(src))){src=src.substring(cap[0].length);tokens.links[cap[1].toLowerCase()]={href:cap[2],title:cap[3]};continue}if(top&&(cap=block.paragraph.exec(src))){src=src.substring(cap[0].length);tokens.push({type:"paragraph",text:cap[0]});continue}if(cap=block.text.exec(src)){src=src.substring(cap[0].length);tokens.push({type:"text",text:cap[0]});continue}}return tokens};var inline={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:noop,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`]| {2,}\n|$)/};inline._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/;inline._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/;inline.link=replace(inline.link)("inside",inline._linkInside)("href",inline._linkHref)();inline.reflink=replace(inline.reflink)("inside",inline._linkInside)();inline.normal={url:inline.url,strong:inline.strong,em:inline.em,text:inline.text};inline.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/};inline.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/};inline.lexer=function(src){var out="",links=tokens.links,link,text,href,cap;while(src){if(cap=inline.escape.exec(src)){src=src.substring(cap[0].length);out+=cap[1];continue}if(cap=inline.autolink.exec(src)){src=src.substring(cap[0].length);if(cap[2]==="@"){text=cap[1][6]===":"?mangle(cap[1].substring(7)):mangle(cap[1]);href=mangle("mailto:")+text}else{text=escape(cap[1]);href=text}out+='<a href="'+href+'">'+text+"</a>";continue}if(cap=inline.url.exec(src)){src=src.substring(cap[0].length);text=escape(cap[1]);href=text;out+='<a href="'+href+'">'+text+"</a>";continue}if(cap=inline.tag.exec(src)){src=src.substring(cap[0].length);out+=options.sanitize?escape(cap[0]):cap[0];continue}if(cap=inline.link.exec(src)){src=src.substring(cap[0].length);out+=outputLink(cap,{href:cap[2],title:cap[3]});continue}if((cap=inline.reflink.exec(src))||(cap=inline.nolink.exec(src))){src=src.substring(cap[0].length);link=(cap[2]||cap[1]).replace(/\s+/g," ");link=links[link.toLowerCase()];if(!link||!link.href){out+=cap[0][0];src=cap[0].substring(1)+src;continue}out+=outputLink(cap,link);continue}if(cap=inline.strong.exec(src)){src=src.substring(cap[0].length);out+="<strong>"+inline.lexer(cap[2]||cap[1])+"</strong>";continue}if(cap=inline.em.exec(src)){src=src.substring(cap[0].length);out+="<em>"+inline.lexer(cap[2]||cap[1])+"</em>";continue}if(cap=inline.code.exec(src)){src=src.substring(cap[0].length);out+="<code>"+escape(cap[2],true)+"</code>";continue}if(cap=inline.br.exec(src)){src=src.substring(cap[0].length);out+="<br>";continue}if(cap=inline.text.exec(src)){src=src.substring(cap[0].length);out+=escape(cap[0]);continue}}return out};function outputLink(cap,link){if(cap[0][0]!=="!"){return'<a href="'+escape(link.href)+'"'+(link.title?' title="'+escape(link.title)+'"':"")+">"+inline.lexer(cap[1])+"</a>"}else{return'<img src="'+escape(link.href)+'" alt="'+escape(cap[1])+'"'+(link.title?' title="'+escape(link.title)+'"':"")+">"}}var tokens,token;function next(){return token=tokens.pop()}function tok(){switch(token.type){case"space":{return""}case"hr":{return"<hr>\n"}case"heading":{return"<h"+token.depth+">"+inline.lexer(token.text)+"</h"+token.depth+">\n"}case"code":{if(options.highlight){token.code=options.highlight(token.text,token.lang);
if(token.code!=null&&token.code!==token.text){token.escaped=true;token.text=token.code}}if(!token.escaped){token.text=escape(token.text,true)}return"<pre><code"+(token.lang?' class="lang-'+token.lang+'"':"")+">"+token.text+"</code></pre>\n"}case"blockquote_start":{var body="";while(next().type!=="blockquote_end"){body+=tok()}return"<blockquote>\n"+body+"</blockquote>\n"}case"list_start":{var type=token.ordered?"ol":"ul",body="";while(next().type!=="list_end"){body+=tok()}return"<"+type+">\n"+body+"</"+type+">\n"}case"list_item_start":{var body="";while(next().type!=="list_item_end"){body+=token.type==="text"?parseText():tok()}return"<li>"+body+"</li>\n"}case"loose_item_start":{var body="";while(next().type!=="list_item_end"){body+=tok()}return"<li>"+body+"</li>\n"}case"html":{if(options.sanitize){return inline.lexer(token.text)}return!token.pre&&!options.pedantic?inline.lexer(token.text):token.text}case"paragraph":{return"<p>"+inline.lexer(token.text)+"</p>\n"}case"text":{return"<p>"+parseText()+"</p>\n"}}}function parseText(){var body=token.text,top;while((top=tokens[tokens.length-1])&&top.type==="text"){body+="\n"+next().text}return inline.lexer(body)}function parse(src){tokens=src.reverse();var out="";while(next()){out+=tok()}tokens=null;token=null;return out}function escape(html,encode){return html.replace(!encode?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function mangle(text){var out="",l=text.length,i=0,ch;for(;i<l;i++){ch=text.charCodeAt(i);if(Math.random()>.5){ch="x"+ch.toString(16)}out+="&#"+ch+";"}return out}function tag(){var tag="(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code"+"|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo"+"|span|br|wbr|ins|del|img)\\b)\\w+";return tag}function replace(regex,opt){regex=regex.source;opt=opt||"";return function self(name,val){if(!name)return new RegExp(regex,opt);regex=regex.replace(name,val.source||val);return self}}function noop(){}noop.exec=noop;function marked(src,opt){setOptions(opt);return parse(block.lexer(src))}var options,defaults;function setOptions(opt){if(!opt)opt=defaults;if(options===opt)return;options=opt;if(options.gfm){block.fences=block.gfm.fences;block.paragraph=block.gfm.paragraph;inline.text=inline.gfm.text;inline.url=inline.gfm.url}else{block.fences=block.normal.fences;block.paragraph=block.normal.paragraph;inline.text=inline.normal.text;inline.url=inline.normal.url}if(options.pedantic){inline.em=inline.pedantic.em;inline.strong=inline.pedantic.strong}else{inline.em=inline.normal.em;inline.strong=inline.normal.strong}}marked.options=marked.setOptions=function(opt){defaults=opt;setOptions(opt);return marked};marked.setOptions({gfm:true,pedantic:false,sanitize:false,highlight:null});marked.parser=function(src,opt){setOptions(opt);return parse(src)};marked.lexer=function(src,opt){setOptions(opt);return block.lexer(src)};marked.parse=marked;if(typeof module!=="undefined"){module.exports=marked}else{this.marked=marked}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());